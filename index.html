<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì†ë‹´ ë¦¬ë¯¹ìŠ¤ í‰ê°€ê¸°</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 80px; background: #f7f8fa; }
    h1 { font-size: 2em; margin-bottom: 10px; }
    button { padding: 10px 20px; font-size: 1em; margin: 10px; border: none; border-radius: 10px; cursor: pointer; background: #4f8cff; color: white; }
    button:hover { background: #336dff; }
    input, textarea { width: 80%; max-width: 500px; padding: 10px; margin: 10px auto; border-radius: 8px; border: 1px solid #ccc; font-size: 1em; display: block; }
    #result { font-size: 1.3em; margin-top: 20px; white-space: pre-line; }

    /* ì‹œì‘ ë¡œê³  (2ì´ˆ ë‚˜íƒ€ë‚¬ë‹¤ ì‚¬ë¼ì§) */
    #logo {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 500px;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      z-index: 1000;
      pointer-events: none; /* í´ë¦­ ë§‰ì§€ ì•Šê²Œ */
    }
    #logo.show { opacity: 1; }

    /* ì˜¤ë¥¸ìª½ ì•„ë˜ a.gif ìƒì‹œ í‘œì‹œ */
    #sideGif {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 300px;
      z-index: 999;
    }
  </style>
</head>
<body>
  <!-- ì‹œì‘ ë¡œê³  -->
  <img id="logo" src="logo.png" alt="logo">

  <!-- ì˜¤ë¥¸ìª½ ì•„ë˜ ê³„ì† ì¬ìƒë˜ëŠ” gif -->
  <img id="sideGif" src="a.gif" alt="side gif">

  <h1>ğŸ¸ ì†ë‹´ ë¦¬ë¯¹ìŠ¤ í‰ê°€ê¸°</h1>
  <button id="loadBtn">ì†ë‹´ ë½‘ê¸°</button>
  <div id="proverbBox"></div>
  <textarea id="remixInput" placeholder="ì†ë‹´ì„ ì›ƒê¸°ê²Œ ë°”ê¿”ë´!" rows="3"></textarea>
  <button id="evalBtn">í‰ê°€í•˜ê¸°</button>
  <div id="result"></div>

  <script>
    const GEMINI_API_KEY = "AIzaSyDh-q2qOEHBgzDUIA3Psd9XwSgTYMkOo64";
    let currentProverb = "";

    // ì‹œì‘í•  ë•Œ ë¡œê³  2ì´ˆë§Œ ë³´ì—¬ì£¼ê¸°
    window.addEventListener("load", () => {
      const logo = document.getElementById("logo");
      logo.classList.add("show");
      setTimeout(() => {
        logo.classList.remove("show");
        logo.style.display = "none"; // ì™„ì „íˆ ì œê±°
      }, 2000);
    });

    async function loadProverb() {
      const res = await fetch("proverbs.csv");
      const text = await res.text();
      const lines = text.trim().split("\n");
      const idx = Math.floor(Math.random() * lines.length);
      const parts = lines[idx].split(",");
      currentProverb = parts[1] || parts[0];
      document.getElementById("proverbBox").innerText = "ì†ë‹´: " + currentProverb;
      document.getElementById("result").innerText = "";
    }

    async function evaluateRemix() {
      const remix = document.getElementById("remixInput").value.trim();
      if (!remix) return alert("ë¦¬ë¯¹ìŠ¤ë¥¼ ì…ë ¥í•´ì¤˜!");
      if (!currentProverb) return alert("ì†ë‹´ì„ ë¨¼ì € ë½‘ì•„!");

      const prompt = `
ì›ë˜ ì†ë‹´: "${currentProverb}"
ë¦¬ë¯¹ìŠ¤: "${remix}"

ì´ ë¦¬ë¯¹ìŠ¤ ë¬¸ì¥ì´ ì–¼ë§ˆë‚˜ ì°¸ì‹ í•˜ê³  ì›ƒê¸´ì§€ 0~100ì ìœ¼ë¡œ í‰ê°€í•˜ê³ , 
ê·¸ ì ìˆ˜ë¥¼ ì¤€ ì´ìœ ë¥¼ í•œ ì¤„ë¡œ ì„¤ëª…í•´ì¤˜. ê·¸ë¦¬ê³  ì ìˆ˜ëŠ” ì¡°ê¸ˆ ë‚®ê²Œ í‰ê°€í•´ì¤˜. ë¹„ì†ì–´ê°€ í¬í•¨ë˜ë©´ ë³´ë„ˆìŠ¤ ì ìˆ˜ 30ì  ì •ë„ ì¤˜. 

ì¶œë ¥ í˜•ì‹:
ì ìˆ˜: (ìˆ«ì)
ì´ìœ : (ì§§ì€ ì„¤ëª…)
      `;

      document.getElementById("result").innerText = "í‰ê°€ ì¤‘...";

      const response = await fetch(
        "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=" + GEMINI_API_KEY,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }]
          })
        }
      );

      const data = await response.json();
      const text = data?.candidates?.[0]?.content?.parts?.[0]?.text || "ì˜¤ë¥˜ ë°œìƒ!";

      const scoreMatch = text.match(/ì ìˆ˜:\s*(\d+)/);
      const reasonMatch = text.match(/ì´ìœ :\s*(.*)/);
      const score = parseInt(scoreMatch ? scoreMatch[1] : 0);
      const reason = reasonMatch ? reasonMatch[1].trim() : "ì´ìœ  ë¶„ì„ ì‹¤íŒ¨!";

      let grade = "";
      if (score >= 80) grade = "ğŸ¤£ í‚¹ê°“ì œë„ˆëŸ´ë ˆì „ë“œ ë“œë¦½ (" + score + "ì )";
      else if (score >= 50) grade = "ğŸ˜† ë‚˜ë¦„ ì°¸ì‹  (" + score + "ì )";
      else if (score >= 30) grade = "ğŸ˜ ê·¸ëƒ¥ ê·¸ëŸ¼ (" + score + "ì )";
      else grade = "ğŸ¥¶ ê°œë…¸ì¼ ëƒ‰ì¥ê³ í–‰ (" + score + "ì )";

      document.getElementById("result").innerText = grade + "\nğŸ’¬ ì´ìœ : " + reason;
    }

    document.getElementById("loadBtn").addEventListener("click", loadProverb);
    document.getElementById("evalBtn").addEventListener("click", evaluateRemix);
  </script>
</body>
</html>
