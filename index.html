<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì†ë‹´ ë¦¬ë¯¹ìŠ¤ í‰ê°€ê¸°</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 80px; background: #f7f8fa; }
    h1 { font-size: 2em; margin-bottom: 10px; }
    button { padding: 10px 20px; font-size: 1em; margin: 10px; border: none; border-radius: 10px; cursor: pointer; background: #4f8cff; color: white; }
    button:hover { background: #336dff; }
    input, textarea { width: 80%; max-width: 500px; padding: 10px; margin: 10px auto; border-radius: 8px; border: 1px solid #ccc; font-size: 1em; display: block; }
    #result { font-size: 1.3em; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>ğŸ¸ ì†ë‹´ ë¦¬ë¯¹ìŠ¤ í‰ê°€ê¸°</h1>
  <button id="loadBtn">ì†ë‹´ ë½‘ê¸°</button>
  <div id="proverbBox"></div>
  <textarea id="remixInput" placeholder="ì†ë‹´ì„ ì›ƒê¸°ê²Œ ë°”ê¿”ë´!" rows="3"></textarea>
  <button id="evalBtn">í‰ê°€í•˜ê¸°</button>
  <div id="result"></div>

  <script>
    const GEMINI_API_KEY = "AIzaSyDh-q2qOEHBgzDUIA3Psd9XwSgTYMkOo64";
    let currentProverb = "";

    async function loadProverb() {
      const res = await fetch("proverbs.csv");
      const text = await res.text();
      const lines = text.trim().split("\n");
      const idx = Math.floor(Math.random() * lines.length);
      const parts = lines[idx].split(",");
      currentProverb = parts[1] || parts[0];
      document.getElementById("proverbBox").innerText = "ì†ë‹´: " + currentProverb;
      document.getElementById("result").innerText = "";
    }

    async function evaluateRemix() {
      const remix = document.getElementById("remixInput").value.trim();
      if (!remix) return alert("ë¦¬ë¯¹ìŠ¤ë¥¼ ì…ë ¥í•´ì¤˜!");
      if (!currentProverb) return alert("ì†ë‹´ì„ ë¨¼ì € ë½‘ì•„!");

      const prompt = `
        ì›ë˜ ì†ë‹´: "${currentProverb}"
        ë¦¬ë¯¹ìŠ¤: "${remix}"
        ìœ„ ë¦¬ë¯¹ìŠ¤ê°€ ì–¼ë§ˆë‚˜ ì°¸ì‹ í•˜ê³  ì›ƒê¸´ì§€ 0~100ì ìœ¼ë¡œ í‰ê°€í•˜ê³ , ìˆ«ìë§Œ ì¶œë ¥í•´.
      `;

      document.getElementById("result").innerText = "í‰ê°€ ì¤‘...";

      const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=" + GEMINI_API_KEY, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }] }]
        })
      });

      const data = await response.json();
      let scoreText = data.candidates?.[0]?.content?.parts?.[0]?.text || "0";
      const score = parseInt(scoreText.match(/\d+/)?.[0] || 0);
      let grade = "";
      if (score >= 80) grade = "ğŸ¤£ ë ˆì „ë“œ ë“œë¦½ (" + score + "ì )";
      else if (score >= 50) grade = "ğŸ˜† ë‚˜ë¦„ ì°¸ì‹  (" + score + "ì )";
      else if (score >= 30) grade = "ğŸ˜ ê·¸ëƒ¥ ê·¸ëŸ¼ (" + score + "ì )";
      else grade = "ğŸ¥¶ ë…¸ì¼ ëƒ‰ì¥ê³ í–‰ (" + score + "ì )";
      document.getElementById("result").innerText = grade;
    }

    document.getElementById("loadBtn").addEventListener("click", loadProverb);
    document.getElementById("evalBtn").addEventListener("click", evaluateRemix);
  </script>
</body>
</html>
